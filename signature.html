<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>电子签名</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="static/css/common.css"/>
		<link rel="stylesheet" type="text/css" href="static/css/app.css"/>
	</head>
	<body class="signature">
		<!--顶部标题栏-->
		<div class="header-top">
			<div class="fl">
				<a href="javascript:;" class="goback">
					<em class="icon-goback"></em>
					<span class="goback-text">返回</span>
				</a>
			</div>
			<h2 class="header-top-title">
				<a class="reset" href="javascript:;">重置</a>
				<a class="sure" href="javascript:;">确定</a>
			</h2>
		</div>
		
		
		<!--签字区域-->
		<div class="signature-content">
			
			<!--<div class="container">
				<div class="js-signature" data-width="750" data-height="200" data-border="1px solid black" data-line-color="#bc0000" data-auto-fit="true">
					
				</div>
			</div>-->
			<canvas></canvas>
		</div>            
		
		
		<script src="static/js/jquery-1.11.0.min.js"  type="text/javascript" charset="utf-8"></script>
		<!--<script src="static/js/jq-signature.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="static/js/draw.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
		
		<script type="text/javascript">
			const canvas = document.querySelector('canvas');
      		var draw = new Draw(canvas, 0);
			console.log(draw)
			
			// 重置
			$('.reset').on('click', function(){
				// 清除画布
				draw.clear()
			})
			
			// 确定
			$('.sure').on('click', function(){
				// 生成图片 
				var image = draw.getPNGImage();
				// base64转图片
				console.log(image)
      			var blob = draw.dataURLtoBlob(image);
      			
      			
      			
      			console.log(blob)
      			
      			
				
				$.ajax({
					type:"post",
					url:base64ImgUploadUrl,
					data: {
						imgfile: image,
						accidentId: accidentId,
					},
				    dataType: "json",
					success: function(data){
						if(data.status == 2000){
							if (window.localStorage.getItem('signatureMine1')) {
								window.localStorage.setItem('signatureMine2',data.src)
							} else{
								window.localStorage.setItem('signatureMine1',data.src)
							}
							console.log(data)
							// 将图片存储到本地
							
		 				}else{
							
						}
					}
				});
					
			});
		
		</script>
	</body>

</html>