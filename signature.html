<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>电子签名</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="static/css/common.css"/>
		<link rel="stylesheet" type="text/css" href="static/css/app.css"/>
	</head>
	<body class="signature">
		<!--顶部标题栏-->
		<div class="header-top">
			<div class="fl">
				<a href="javascript:;" class="goback">
					<em class="icon-goback"></em>
					<span class="goback-text">返回</span>
				</a>
			</div>
			<h2 class="header-top-title">
				<a class="reset" href="javascript:;">重置</a>
				<a class="sure" href="javascript:;">确定</a>
			</h2>
		</div>
		
		
		<!--签字区域-->
		<div class="signature-content">
			
			<!--<div class="container">
				<div class="js-signature" data-width="750" data-height="200" data-border="1px solid black" data-line-color="#bc0000" data-auto-fit="true">
					
				</div>
			</div>-->
			<canvas></canvas>
		</div>            
		
		
		<script src="static/js/jquery-1.11.0.min.js"  type="text/javascript" charset="utf-8"></script>
		<!--<script src="static/js/jq-signature.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="static/js/draw.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
		
		<script type="text/javascript">
			const canvas = document.querySelector('canvas');
      		var draw = new Draw(canvas, 0);
			console.log(draw)
			
			// 重置
			$('.reset').on('click', function(){
				// 清除画布
				draw.clear()
			})
			
			// 确定
			$('.sure').on('click', function(){
				// 生成图片 
				var image = draw.getPNGImage();
				// base64转图片
				console.log(image)
      			var blob = draw.dataURLtoBlob(image);
      			
      			// 
      			draw.downloadPNGImage(image)
      			
      			console.log(blob)
      			
      			var file = dataURLtoFile(image,'111')
      			console.log(file)
      			var formData = new FormData();
				formData.append('image', file)
				
				$.ajax({
					type:"post",
					url:uploadImgUrl,
					data: formData,
					processData: false,
			        contentType: false,
			        dataType: "json",
					success: function(data){
						console.log(data)
						if(data.status == 2000){
						
						}
					}
				});
				
				function dataURLtoFile(dataurl, filename) {//将base64转换为文件
				    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
				    bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
				    while(n--){
				        u8arr[n] = bstr.charCodeAt(n);
				    }
				    return new File([u8arr], filename, {type:mime});
				}
				
				
				//var dataUrl = $('.js-signature').eq(1).jqSignature('getDataURL');
				
			});
			
//			  const d = document;
//		      const w = window.innerWidth || d.documentElement.clientWidth || d.body.clientWidth;
//		      const h = window.innerHeight || d.documentElement.clientHeight || d.body.clientHeight;
//		      let length = (h - w) / 2;
//		      let width = w;
//		      let height = h;
		      
		      
		      
			
//			$(document).on('ready', function() {
//				if ($('.js-signature').length) {
//					$('.js-signature').jqSignature();
//				}
//			});
//
//			function clearCanvas() {
//				$('#signature').html('<p><em>Your signature will appear here when you click "Save Signature"</em></p>');
//				$('.js-signature').eq(1).jqSignature('clearCanvas');
//				$('#saveBtn').attr('disabled', true);
//			}
//	
//			function saveSignature() {
//				$('#signature').empty();
//				var dataUrl = $('.js-signature').eq(1).jqSignature('getDataURL');
//				var img = $('<img>').attr('src', dataUrl);
//				$('#signature').append($('<p>').text("Here's your signature:"));
//				$('#signature').append(img);
//			}
//	
//			$('.js-signature').eq(1).on('jq.signature.changed', function() {
//				$('#saveBtn').attr('disabled', false);
//			});
		
		
		// 签字生成图片上传服务器
		
		</script>
	</body>

</html>