<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>上传事故照片</title>
  <link rel="stylesheet" type="text/css" href="static/css/common.css"/>
 	<link rel="stylesheet" href="static/css/app.css" />
	<link rel="stylesheet" type="text/css" href="static/css/app1.css"/>
</head>
<body class="upload-page">
	<!--顶部标题栏-->
	<div class="header-top">
		<div class="fl">
			<a href="javascript:;" class="goback">
				<em class="icon-goback"></em>
				<span class="goback-text">返回</span>
			</a>
		</div>
		<h2 class="header-top-title">上传事故照片</h2>
	</div>
	
	<!--顶部警察提示-->
	<div class="police">
		<img class="fl" src="static/images/common/police2.png"/>
		<div class="police-content">
			<span>温馨提示</span>
			<p>请您在保证自身安全的情况下操作，请选择事故类型！</p>
		</div>
	</div>
	
	<div class="upload-content">
		<!--获取地址天气等信息-->
		<ul class="msg">
			<li>
				<a href="map.html">
					<span>事故地址</span>
					<span>重庆市渝北区金开大道</span>
					<em class="fr"></em>
				</a>
			</li>
			<li>
				<span>高速/高架</span>
				<span class="choose-box active"></span>
				<span data='0'>是</span>
				<span class="choose-box"></span>
				<span data='1'>否</span>
			</li>
			<li>
				<span>事故时间</span>
				<span>2018-01-26</span>
				<span>11:08</span>
			</li>
			<li>
				<span>地点天气</span>
				<span>雨</span>
				<em class="fr"></em>
			</li>
		</ul>
		<!--上传事故照片-->
		<ul class="uploadpicture clearfix">
			<li>
				<div class="box">
					<img src="static/images/main/carfront.png"/>
					<em></em>
				</div>
				<div class="upload-msg">
					<input type="file"/>
				</div>
				<p>侧前方</p>
			</li>
			<li>
				<div class="box">
					<img src="static/images/main/carfront.png"/>
					<em></em>
				</div>
				<div class="upload-msg">
					<input type="file"/>
				</div>
				<p>侧前方</p>
			</li>
		</ul>
		<ul class="uploadpicture clearfix">
			<li>
				<div class="box">
					<img src="static/images/main/carfront.png"/>
					<em></em>
				</div>
				<div class="upload-msg">
					<input type="file"/>
				</div>
				<p>侧前方</p>
			</li>
			<li>
				<div class="box">
					<img src="static/images/main/carfront.png"/>
				</div>
				<div class="upload-msg">
					<input type="file"/>
				</div>
				<p>侧前方</p>
			</li>
		</ul>
		<ul class="uploadpicture clearfix">
			<li>
				<div class="box">
					<img src="static/images/main/carfront.png"/>
				</div>
				<div class="upload-msg">
					<input type="file"/>
				</div>
				<p>侧前方</p>
			</li>
			<li>
				<div class="box">
					<img src="static/images/main/carfront.png"/>
				</div>
				<div class="upload-msg">
					<input type="file"/>
				</div>
				<p>侧前方</p>
			</li>
		</ul>
	</div>
	<div class="btn">
		<a href="javascript:;">
			提交照片
		</a>
	</div>
	
	

<script src="static/js/jquery-3.1.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
<!--当前页面交互-->
<script type="text/javascript">
	// 选择是否为高速/高架
	$('.upload-content .msg li .choose-box').click(function(){
		if (!$(this).hasClass('active')) {
			$(this).addClass('active');
			$(this).siblings().removeClass('active');
		} else if($(this).hasClass('active')){
			$(this).siblings('active').addClass('active');
			$(this).removeClass('active');
		}
	})
	
	
//	上传图片
	function uploadImg(that){
		var accidentId = localStorage.getItem('accidentId');
		var formData = new FormData();	
		formData.append('files',that[0].files[0]);
		formData.append('accidentId',accidentId)
	
		$.ajax({
			type:"post",
			url:uploadImgUrl,
			data: formData,
			processData: false,
	        contentType: false,
	        dataType: "json",
			success: function(data){
				if(data.status == 2000){
					console.log(data.list[0])
					that.parent('div').siblings('div').children('img').attr("src",data.list[0]).css({
						'width':'100%',
						'height':'8.333333rem',
						'margin-top':'0'
					});
				}
			}
		});
		that.closest('div').css('background','none');
	}
	
	$('.uploadpicture .upload-msg input[type="file"]').click(function(){
		$(this).change(function(){
			var that = $(this);
			uploadImg(that);
		});
	})
	$('.btn').click(function(){
		var address = $('.upload-content .msg li').eq(0).children('a').children('span').eq(1).html();
		var fastRoad = $('.upload-content .msg li').eq(1).children('.choose-box.active').next('span').attr('data');
		var accidentDate = $('.upload-content .msg li').eq(2).children('span').eq(1).html()+"  "+$('.upload-content .msg li').eq(2).children('span').eq(2).html()
		var weather = $('.upload-content .msg li').eq(3).children('span').eq(1).html();
		var picOne = $('.upload-content .uploadpicture li').eq(0).children('.box').children('img').attr('src');
		var picTwo = $('.upload-content .uploadpicture li').eq(1).children('.box').children('img').attr('src');
		var picThree = $('.upload-content .uploadpicture li').eq(2).children('.box').children('img').attr('src');
		var otherOne = $('.upload-content .uploadpicture li').eq(3).children('.box').children('img').attr('src')||'';
		var otherTwo = $('.upload-content .uploadpicture li').eq(4).children('.box').children('img').attr('src')||'';
		var otherThree = $('.upload-content .uploadpicture li').eq(5).children('.box').children('img').attr('src')||'';
		$.ajax({
			type:"post",
			url:accidentImgUrl,
			data: {
				token:localStorage.getItem('token'),
				accidentId:localStorage.getItem('accidentId'),
				address:address,
				address_xy:('',''),
				isExpressway:fastRoad,
				datetime:accidentDate,
				weather:weather,
				mainPic1:picOne,
				mainPic2:picTwo,
				mainPic3:picThree,
				otherPic1:otherOne,
				otherPic2:otherTwo,
				otherPic3:otherThree
			},
			success: function(data){
				console.log(data);
				if(data.status == 2000){
					if (data.num=='0') {
						window.location.href='accidentaudit.html';
					} else{
						window.location.href='accidentaudit_pass.html';
					}
				}
			}
		});
	})
</script>

</body>
</html>