<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>短信验证</title>
  <link rel="stylesheet" type="text/css" href="static/css/common.css"/>
 	<link rel="stylesheet" href="static/css/app.css" />
</head>
<body class="msg-certificati-page bg-f4">
	<!--顶部标题栏-->
	<div class="header-top">
		<div class="fl">
			<a href="javascript:;" class="goback">
				<em class="icon-goback"></em>
				<span class="goback-text">返回</span>
			</a>
		</div>
		<h2 class="header-top-title">短信验证</h2>
	</div>
	
	<!--顶部警察提示-->
	<div class="police bg-f">
		<img class="fl" src="static/images/common/police2.png"/>
		<div class="police-content">
			<ul>
				<li>事故时间：2017-01-11 17：30</li>
				<li>事故地点：渝北区</li>
				<li>事故天气：雪</li>
				<li>事故情形：在变更车道时候</li>
			</ul>
		</div>
	</div>
	
	<!--中间内容区-->
	<div class="msg-certification-content">
		<form class="form">
			<div class="form-group">
				<em>本方信息</em>
				<div class="fr"></div>
			</div>
			
			<div class="form-group">
				<span>姓名</span>
				<em class="fr">秦牧</em>
			</div>
			
			<div class="form-group">
				<span>号牌号码</span>
				<em class="fr">渝A2B440</em>
			</div>
			
			<div class="form-group">
				<span>手机号码</span>
				<em class="fr phone1">18716288752</em>
			</div>
			
			<div class="form-group">
				<span>验证码</span>
				<em class="fr msg-btn getcode1">获取验证码</em>
				<input type="text" class="fr yzmcode1" placeholder="请输入验证码">
			</div>
			
			<div class="form-group">
				<span>签字</span>
				<em class="fr msg-btn">签字</em>
			</div>
		</form>
			
		<form class="form">
			<div class="form-group">
				<em>对方信息</em>
			</div>
			
			<div class="form-group">
				<span>姓名</span>
				<em class="fr">秦牧</em>
			</div>
			
			<div class="form-group">
				<span>号牌号码</span>
				<em class="fr">渝A2B440</em>
			</div>
			
			<div class="form-group">
				<span>手机号码</span>
				<em class="fr phone2">13650543568</em>
			</div>
			
			<div class="form-group">
				<span>验证码</span>
				<em class="fr msg-btn getcode2">获取验证码</em>
				<input type="text" class="fr yzmcode2" placeholder="请输入验证码">
			</div>
			
			<div class="form-group">
				<span>签字</span>
				<em class="fr msg-btn">签字</em>
			</div>
			
		</form>
	</div>
	
	<div class="btn">
		<a href="javascript:;">
			完成
		</a>
	</div>
	<div class="action-modal">
		<p>您的手机号有误，请重新输入！</p>
	</div>
<script src="static/js/jquery-3.1.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
<!--当前页面交互-->
<script type="text/javascript">
$(function(){
	// 获取事故信息
	//getAccidentInfoUrl
	
	
	// 获取事故人信息
	getAccidentUserInfoUrl
	
	
	// 提交的時候 accidentAuthUrl
	
	
	getcode('.getcode1','.phone1','.yzmcode1')
	getcode('.getcode2','.phone2','.yzmcode2')
	// 短信验证码
	function getcode(obj,item1,item2){
		var on = true;
	

	$(obj).on('click',function(){
	if(on){
		// 手机号验证
		var phone = $(item1).html();
		var regphone = /^1\d{10}$/;
		if(!regphone.test(phone)){
			$('.action-modal').show()
			$('.action-modal p').html('您的手机号有误，请重新输入！')
			setTimeout(function(){
				$('.action-modal').hide()
			},500)	
		}else{
			// 倒计时60s
			var time = 60;
			var timer = null;
			clearInterval(timer);
		
				// 获取验证码
				$.ajax({
			    type: "POST",
			    url: yzcodeUrl,
			  	data:{
						phone:$(item1).html(),
						type:'4'
					},
			    success: function(data){
			    	//alert(data)
			   		//服务器返回响应，根据响应结果，分析是否登录成功；
						if(data.status == 2000){
							$(item2).val(data.obj)
						}
			    }
				})
				
				timer = setInterval(function(){
				time--;
				$(obj).html(time + '&nbsp;S');
				$(obj).css('background','#ccc');
				// 按钮禁用
				
				if(time < 0){
						$(obj).html('重新发送');
						$(obj).css('background','red');
						time = 0;
						clearInterval(timer);
						on = true;
					}else{
						on = false;
					}
				},1000)
		}
	}
})
	}
	
	
	// 点击签字
	
	
	
	// 点击完成
	
	
})
	
	
	// 获取当前页面数据
	// 获取事故人信息
	$.ajax({
		type:"post",
		url:accidentAuthStatusUrl,
		data:{
			token:localStorage.getItem('token'),
			accidentId:localStorage.getItem('accidentId')
		},
		success:function(data){
			console.log(data)
			if (data.status==2000) {
				var Len = data.list.length;
				for (var i=0;i<Len;i++) {
					$('.mymsg-content .form').eq(i+1).children('.form-group').eq(1).children('em').html(data.list[i].name);
					$('.mymsg-content .form').eq(i+1).children('.form-group').eq(2).children('em').html(data.list[i].car_no);
					$('.mymsg-content .form').eq(i+1).children('.form-group').eq(3).children('em').html(data.list[i].phone);
				}
			}
		}
	});
	$('.form').each(function(){
		$(this).children('.form-group').eq(5).children('em').click(function(){
			window.location.href='signature.html';
		})
	})
	
	$('.msg-certificati-page .btn').click(function(){
//		$.ajax({
//			type:"post",
//			url:"",
//			async:true
//		});
		window.location.href='fastfixduty_pass.html'
	})
</script>

</body>
</html>