<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>短信验证</title>
  <link rel="stylesheet" type="text/css" href="static/css/common.css"/>
 	<link rel="stylesheet" href="static/css/app.css" />
</head>
<body class="msg-certificati-page bg-f4">
	<!--顶部标题栏-->
	<div class="header-top">
		<div class="fl">
			<a href="javascript:;" class="goback">
				<em class="icon-goback"></em>
				<span class="goback-text">返回</span>
			</a>
		</div>
		<h2 class="header-top-title">短信验证</h2>
	</div>
	
	<!--顶部警察提示-->
	<div class="police bg-f">
		<img class="fl" src="static/images/common/police2.png"/>
		<div class="police-content">
			<ul>
				<li>事故时间：2017-01-11 17：30</li>
				<li>事故地点：渝北区</li>
				<li>事故天气：雪</li>
				<li>事故情形：在变更车道时候</li>
			</ul>
		</div>
	</div>
	
	<!--中间内容区-->
	<div class="msg-certification-content">
		<form class="form">
			<div class="form-group">
				<em>本方信息</em>
				<div class="fr"></div>
			</div>
			
			<div class="form-group">
				<span>姓名</span>
				<em class="fr">秦牧</em>
			</div>
			
			<div class="form-group">
				<span>号牌号码</span>
				<em class="fr">渝A2B440</em>
			</div>
			
			<div class="form-group">
				<span>手机号码</span>
				<em class="fr phone1">18716288752</em>
			</div>
			
			<div class="form-group">
				<span>验证码</span>
				<em class="fr msg-btn getcode1">获取验证码</em>
				<input type="text" class="fr yzmcode1" placeholder="请输入验证码">
			</div>
			
			<div class="form-group">
				<span>签字</span>
				<em class="fr msg-btn">签字</em>
				<div class="fr sinate1">
					<img src="static/images/common/card_xingshizheng.png"/>
				</div>
			</div>
		</form>
			
		<form class="form">
			<div class="form-group">
				<em>对方信息</em>
			</div>
			
			<div class="form-group">
				<span>姓名</span>
				<em class="fr">秦牧</em>
			</div>
			
			<div class="form-group">
				<span>号牌号码</span>
				<em class="fr">渝A2B440</em>
			</div>
			
			<div class="form-group">
				<span>手机号码</span>
				<em class="fr phone2">13650543568</em>
			</div>
			
			<div class="form-group">
				<span>验证码</span>
				<em class="fr msg-btn getcode2">获取验证码</em>
				<input type="text" class="fr yzmcode2" placeholder="请输入验证码">
			</div>
			
			<div class="form-group">
				<span>签字</span>
				<em class="fr msg-btn">签字</em>
				<div class="fr sinate2">
					<img src="static/images/common/card_xingshizheng.png"/>
				</div>
			</div>
			
		</form>
	</div>
	
	<div class="btn">
		<a href="javascript:;">
			完成
		</a>
	</div>
	<div class="action-modal">
		<p>您的手机号有误，请重新输入！</p>
	</div>
<script src="static/js/jquery-3.1.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
<!--当前页面交互-->
<script type="text/javascript">
$(function(){
	// 获取事故信息
	$.ajax({
    type: "post",
    url: getAccidentInfoUrl,
  	data:{
			token: token,
			accidentId: accidentId
		},
    success: function(res){
    	console.log(res)
    	var data = res.pagination;
    	
			if(res.status == 2000){
				$('.police-content ul li').eq(0).html('事故时间：' + data.create_time);
				$('.police-content ul li').eq(1).html('事故地点：：' + data.address);
				$('.police-content ul li').eq(2).html('事故天气：' + data.weather);
				$('.police-content ul li').eq(3).html('事故情形：' + data.viewname);
			}
    }
	})
	
	// 获取事故人信息
	$.ajax({
    type: "post",
    url: getAccidentUserInfoUrl,
		data:{
			token: token,
			accidentId: accidentId
		},
    success: function(res){
    	console.log(res)
    	var data = res.list;
			if(res.status == 2000){
				var Len = data.length;
				for (var i=0;i<Len;i++) {
					$('.msg-certification-content .form').eq(i).children('.form-group').eq(1).children('em').html(data[i].name);
					$('.msg-certification-content .form').eq(i).children('.form-group').eq(2).children('em').html(data[i].car_no);
					$('.msg-certification-content .form').eq(i).children('.form-group').eq(3).children('em').html(data[i].phone);
					$('.form').eq(i).attr('data',data[i].id)
				}
			}
    }
	})

	// 点击签字
	$('.form').each(function(){
		$(this).children('.form-group').eq(5).children('em').click(function(){
			//window.location.href='signature.html';
		})
	})
	
	// 提交的時候 accidentAuthUrl
	
	
	
	
	
	
	// 点击完成
	$('.msg-certificati-page .btn').click(function(){
		var user = [
			{'uid':$('.form').eq(0).attr('data'),'yzcode': $('.yzmcode1').val(),'phone': $('.phone1').html(),'pic': $('.sinate1 img').attr('src')},
			{'uid':$('.form').eq(1).attr('data'),'yzcode': $('.yzmcode2').val(),'phone': $('.phone2').html(),'pic': $('.sinate2 img').attr('src')}
		]
		user = JSON.stringify(user)
		$.ajax({
	    type: "POST",
	    url: accidentAuthUrl,
	  	data:{
				token: token,
				accidentId: accidentId,
				user: user
			},
	    success: function(data){
				if(data.status == 2000){
					console.log(data)
					window.location.href='accimsg_list.html'
				}
	    }
		})
	})
	
	
	
	
	
	// 短信验证码
	getcode('234','.getcode1','.phone1','.yzmcode1')
	getcode('235','.getcode2','.phone2','.yzmcode2')

	function getcode(uid,obj,item1,item2){
		var on = true;
		 

	$(obj).on('click',function(){
	if(on){
		// 手机号验证
		var phone = $(item1).html();
		var regphone = /^1\d{10}$/;
		if(!regphone.test(phone)){
			$('.action-modal').show()
			$('.action-modal p').html('您的手机号有误，请重新输入！')
			setTimeout(function(){
				$('.action-modal').hide()
			},500)	
		}else{
			// 倒计时60s
			var time = 60;
			var timer = null;
			clearInterval(timer);
		
				// 获取验证码
				$.ajax({
			    type: "POST",
			    url: yzcodeUrl,
			  	data:{
			  		token: token,
						phone:$(item1).html(),
						accidentId:accidentId,
						uid: uid,
						type:'3'
					},
			    success: function(data){
			    	//alert(data)
			   		//服务器返回响应，根据响应结果，分析是否登录成功；
						if(data.status == 2000){
							$(item2).val(data.obj)
						}
			    }
				})
				
				timer = setInterval(function(){
				time--;
				$(obj).html(time + '&nbsp;S');
				$(obj).css('background','#ccc');
				// 按钮禁用
				
				if(time < 0){
						$(obj).html('重新发送');
						$(obj).css('background','red');
						time = 0;
						clearInterval(timer);
						on = true;
					}else{
						on = false;
					}
				},1000)
		}
	}
})
	}
	
	
	
	
	
})
</script>

</body>
</html>