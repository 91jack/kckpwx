<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <title>上传证件照片</title>
  <link rel="stylesheet" type="text/css" href="static/css/common.css"/>
 	<link rel="stylesheet" href="static/css/app.css" />
</head>
<body class="uploadpicture-page">
	<!--顶部标题栏-->
	<div class="header-top">
		<div class="fl">
			<a href="javascript:;" class="goback">
				<em class="icon-goback"></em>
				<span class="goback-text">返回</span>
			</a>
		</div>
		<h2 class="header-top-title">上传证件照片</h2>
	</div>
	
	
	<!--内容区图片区-->
	<div class="uploadpicture-content">
		<img src="" onerror="this.src='static/images/main/fourpic.png'" id="fourImg"/>
		<div class="upload-btn">
			<input type="file" accept="image/*" id="uploadImage"/>
		</div>
	</div>
	
	<div class="btn">
		<a href="javascript:;">
			提交照片
		</a>
	</div>
	

<script src="static/js/jquery-3.1.1.min.js"  type="text/javascript" charset="utf-8"></script>
<script src="static/js/config.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"  type="text/javascript" charset="utf-8"></script>
<!--当前页面交互-->
<script type="text/javascript">
$(function(){
	// 获取四合一照片
	$.ajax({
		type:"post",
		url:getFourInOnePicUrl,
		data:{
			token:localStorage.getItem('token'),
			accidentId:localStorage.getItem('accidentId')
		},
		success:function(data){
			console.log(data)
			if (data.status==2000) {
				$('#fourImg').attr('src',data.list[0])
			}
		}
	});
	
	// 四合一照片拍照上传
	$('#uploadImage').change(function(){
		var that = $(this)
		var formData = new FormData();	
		formData.append('files',that[0].files[0]);
		formData.append('accidentId',accidentId)
	
		$.ajax({
			type:"post",
			url:uploadImgUrl,
			data: formData,
			processData: false,
	    contentType: false,
	    dataType: "json",
			success: function(data){
				if(data.status == 2000){
					$('#fourImg').attr('src',data.list[0])
				}
			}
		});
	})
	
	// 提交照片
	$('.btn').click(function(){
		console.log($('#fourImg').attr('src'))
		$.ajax({
			type:"post",
			url:addFourInOneUrl,
			data: {
				token: token,
				accidentId: accidentId,
				pic : $('#fourImg').attr('src')
			},
	    dataType: "json",
			success: function(data){
				if(data.status == 2000){
					console.log(data)
				}
			}
		});
	});
	
	
	
	
})
	
</script>

</body>
</html>